{% extends 'base.html' %}

{% block content %}
<h2>–ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Alfa-–Ω–æ–º–µ—Ä–æ–≤</h2>

<form method="post" enctype="multipart/form-data">
  {% csrf_token %}

  <div class="import-box">
    <label for="excel_file"><b>–ò–º–ø–æ—Ä—Ç –∏–∑ Excel/CSV (–ø–µ—Ä–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü, –±–µ–∑ —à–∞–ø–∫–∏):</b></label>
    <input type="file" id="excel_file" name="excel_file" accept=".xlsx,.xls,.csv">
    <button type="submit" name="action" value="import_excel">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
    {% if import_message %}
      <div class="import-message">{{ import_message }}</div>
    {% endif %}
    {% if import_errors %}
      <ul class="import-errors">
        {% for err in import_errors %}
          <li>{{ err }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>

  <hr>

  <div id="alfa-container">
    {% for name in prev_alfa_names %}
    <div class="alfa-row">
      <input type="text" name="alfa_names[]" value="{{ name }}" placeholder="Alfa-–Ω–æ–º–µ—Ä" required>
      <button type="button" onclick="removeRow(this)">‚àí</button>
    </div>
    {% endfor %}
  </div>

  <button type="button" onclick="addAlfaRow()">+ –î–æ–±–∞–≤–∏—Ç—å –µ—â—ë</button>
  <br><br>

  <label>–ú–∞—Ç–µ—Ä–∏–Ω—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è:</label>
  <select name="mother_id" required>
    <option value="">‚Äî –í—ã–±–µ—Ä–∏—Ç–µ ‚Äî</option>
    {% for m in mothers %}
      <option value="{{ m.id }}" {% if m.id|stringformat:"s" == prev_mother_id %}selected{% endif %}>{{ m.name }}</option>
    {% endfor %}
  </select><br><br>

  <label>–¶–µ–Ω–∞:</label>
  <input type="text" name="price" value="{{ prev_price }}"><br>

  <label>–í–∞–ª—é—Ç–∞:</label>
  <input type="text" name="currency" value="{{ prev_currency|default:"—Ä—É–±" }}"><br>

  <label>–∞–±–æ–Ω –ø–ª–∞—Ç–∞:</label>
  <input type="text" name="fee" value="{{ prev_fee }}"><br>

  <label>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</label>
  <input type="date" name="data_start" value="{{ prev_data_start }}"><br>

  <label>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</label>
  <input type="date" name="data_end" value="{{ prev_data_end }}"><br><br>

  <button type="submit" name="action" value="save">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  <a href="{% url 'sms_blinoff:alfa_list' %}" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</a>
</form>

<script>
function addAlfaRow() {
  const container = document.getElementById("alfa-container");
  const div = document.createElement("div");
  div.classList.add("alfa-row");
  div.innerHTML = `
    <input type="text" name="alfa_names[]" placeholder="Alfa-–Ω–æ–º–µ—Ä" required>
    <button type="button" onclick="removeRow(this)">‚àí</button>
  `;
  container.appendChild(div);
}

function removeRow(btn) {
  const row = btn.parentElement;
  row.remove();
}
</script>

<style>
  .alfa-row { margin-bottom: 8px; }
  input[type="text"] { min-width: 200px; }
  button[type="button"] { margin-left: 6px; }
  .import-box { margin-bottom: 12px; }
  .import-message { margin-top: 6px; font-size: 0.95em; }
  .import-errors { margin-top: 6px; color: #a00; }
</style>
{% endblock %}
