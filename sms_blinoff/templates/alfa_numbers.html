{% extends 'base.html' %}

{% block title %}–°–ø–∏—Å–æ–∫ Alfa-–Ω–æ–º–µ—Ä–æ–≤{% endblock %}

{% block content %}
<h2 class="mt-3 mb-4">üÖ∞Ô∏è –°–ø–∏—Å–æ–∫ Alfa-–Ω–æ–º–µ—Ä–æ–≤</h2>

<div class="mb-3">
  <button id="export-btn" class="btn btn-success">üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
</div>  

<div class="mb-4 d-flex gap-2">
  <a href="{% url 'sms_blinoff:add_alfa' %}" class="btn btn-success">
    ‚ûï –î–æ–±–∞–≤–∏—Ç—å Alfa-–Ω–æ–º–µ—Ä
  </a>
  <button id="edit-selected-btn" class="btn btn-warning" disabled>üõ† –ú–∞—Å—Å–æ–≤–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
</div>

<div class="table-responsive">
  <table id="alfa-table" class="table table-bordered table-striped table-sm datatable">
    <thead class="table-light">
      <tr>
        <th><input type="checkbox" id="select-all"></th>
        <th>ID</th>
        <th>Alfa Name</th>
        <th>Mother Name</th>
        <th>Price</th>
        <th>Currency</th>
        <th>Fee</th>
        <th>Start</th>
        <th>End</th>
        <th>Created</th>
        <th>‚úèÔ∏è</th>
        <th>üìÑ</th>
      </tr>
    </thead>
    <tbody>
      {% for a in alfa_list %}
        <tr>
          <td><input type="checkbox" class="row-checkbox" value="{{ a.id }}"></td>
          <td>{{ a.id }}</td>
          <td>{{ a.alfa_name }}</td>
          <td>{{ a.mother_name }}</td>
          <td>{{ a.price }}</td>
          <td>{{ a.currency }}</td>
          <td>{{ a.fee }}</td>
          <td>{{ a.data_start }}</td>
          <td>{{ a.data_end }}</td>
          <td>{{ a.data_created }}</td>
          <td><a href="{% url 'sms_blinoff:edit_alfa' a.id %}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a></td>
          <td><a href="{% url 'sms_blinoff:copy_alfa' a.id %}" class="btn btn-sm btn-outline-success">üìÑ</a></td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="12" class="text-center">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const checkboxes = document.querySelectorAll('.row-checkbox');
    const editBtn = document.getElementById('edit-selected-btn');
    const selectAll = document.getElementById('select-all');

    function updateButtonState() {
      const anyChecked = Array.from(checkboxes).some(cb => cb.checked);
      editBtn.disabled = !anyChecked;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ –≤—ã–±–æ—Ä–∞
    selectAll.addEventListener('change', function () {
      checkboxes.forEach(cb => cb.checked = this.checked);
      updateButtonState();
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–¥–Ω–æ–≥–æ —á–µ–∫–±–æ–∫—Å–∞
    checkboxes.forEach(cb => {
      cb.addEventListener('change', updateButtonState);
    });

    // –ö–Ω–æ–ø–∫–∞ –º–∞—Å—Å–æ–≤–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    editBtn.addEventListener('click', function () {
      const selectedIds = Array.from(checkboxes)
        .filter(cb => cb.checked)
        .map(cb => cb.value);

      if (selectedIds.length === 0) return;

      const url = "{% url 'sms_blinoff:mass_edit_alfa' %}?ids=" + selectedIds.join(",");
      window.location.href = url;
    });
  });
</script>
{% endblock %}
