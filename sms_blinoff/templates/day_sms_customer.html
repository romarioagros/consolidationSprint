{% extends 'base.html' %}

{% block title %}SMS –∑–∞ –ø–µ—Ä–∏–æ–¥{% endblock %}

{% block content %}
<h2 class="mt-3 mb-4">üìä SMS Blinoff: {{ start }} ‚Üí {{ end }}</h2>

<div class="row mb-4">
    <div class="col-md-3">
      <input
        type="date"
        id="start-date"                      
        class="form-control"
        value="{{ start|date:'Y-m-d' }}"      
      >
    </div>
    <div class="col-md-3">
      <input
        type="date"
        id="end-date"                        
        class="form-control"
        value="{{ end|date:'Y-m-d' }}"
      >
    </div>
    <div class="col-md-2">
      <button
        type="button"                       
        id="go-btn"                         
        class="btn btn-primary"
      >–ü–æ–∫–∞–∑–∞—Ç—å</button>
    </div>
  </div>
  

<div class="table-responsive">
  <table id="stats-table" class="table table-striped table-bordered">
    <thead class="table-light">
      <tr>
        <th>–î–µ–Ω—å</th>
        <th>Sender</th>
        <th>CG</th>
        <th>CD</th>
        <th>Receiver</th>
        <th>–í—Å–µ–≥–æ SMS</th>
      </tr>
    </thead>
    <tbody>
      {% for r in rows %}
      <tr>
        <td>{{ r.day|date:"Y-m-d" }}</td>
        <td>{{ r.name_sq }}</td>
        <td>{{ r.num_cg_direction }}</td>
        <td>{{ r.num_cd_direction }}</td>
        <td>{{ r.name_sd }}</td>
        <td>{{ r.total_count }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="6" class="text-center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script>
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable
  $(function() {
    $('#stats-table').DataTable({
      language: {
        search: "–ü–æ–∏—Å–∫:",
        lengthMenu: "–ü–æ–∫–∞–∑–∞—Ç—å _MENU_",
        zeroRecords: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
        info: "–ü–æ–∫–∞–∑–∞–Ω–æ _START_‚Äì_END_ –∏–∑ _TOTAL_",
        paginate: { previous: "‚Üê", next: "‚Üí" }
      }
    });
  });

  // –ö–Ω–æ–ø–∫–∞ ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª
  document.addEventListener("DOMContentLoaded", function() {
    // –°–µ–ª–µ–∫—Ç–æ—Ä—ã ID –¥–æ–ª–∂–Ω—ã —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å HTML
    const startInput = document.getElementById('start-date');
    const endInput   = document.getElementById('end-date');
    const goBtn      = document.getElementById('go-btn');

    // –ï—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî –ø–µ—Ä–µ—Å—Ç–∞–Ω—å—Ç–µ —Å—Ä–∞–∑—É –ø–∞–¥–∞—Ç—å
    if (!startInput || !endInput || !goBtn) return;

    goBtn.addEventListener('click', function() {
      // value –∏–∑ <input type="date"> —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ yyyy-MM-dd
      let s = startInput.value.replace(/-/g, '.');
      let e = endInput.value  .replace(/-/g, '.');
      const urlTemplate = "{% url 'sms_blinoff:sms_periode' 'PERIOD' %}";
      const newUrl = urlTemplate.replace('PERIOD', s + '-' + e);
      window.location.href = newUrl;
    });
  });
</script>
{% endblock %}
