{% extends 'base.html' %}

{% block title %}–ö–∞—Ç–µ–≥–æ—Ä–∏—è 3{% endblock %}

{% block content %}
<h2 class="mt-3 mb-4">üìÇ Category 3 (–ê–ª—å—Ñ–∞-–Ω–æ–º–µ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è 3)</h2>

<div class="table-responsive">
  <table id="category3-table" class="table table-striped table-bordered">
    <thead class="table-light">
      <tr>
        <th>Name_3</th>
        <th>Price</th>
      </tr>
    </thead>
    <tbody>
      {% for c in categories %}
      <tr>
        <td>{{ c.name_3 }}</td>
        <td>{{ c.price }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="2" class="text-center">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <button class="btn btn-success mb-3" onclick="exportToExcel()">
    üì• –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
  </button>

    


</div>
{% endblock %}

{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script>
    $(function(){
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DataTable
      const table = $('#category3-table').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
        language: {
          search: "–ü–æ–∏—Å–∫:",
          lengthMenu: "–ü–æ–∫–∞–∑–∞—Ç—å _MENU_ –∑–∞–ø–∏—Å–µ–π",
          zeroRecords: "–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
          info: "–ü–æ–∫–∞–∑–∞–Ω–æ _START_‚Äì_END_ –∏–∑ _TOTAL_",
          paginate: { previous: "‚Üê", next: "‚Üí" }
        }
      });

      // –≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫ (–Ω–µ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
      window.exportToExcel = function() {
        // 1) –ó–∞–≥–æ–ª–æ–≤–∫–∏
        const headers = [];
        $('#category3-table thead th').each(function(){
          headers.push($(this).text().trim());
        });

        // 2) –î–∞–Ω–Ω—ã–µ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫
        const allData = table.rows().data().toArray();

        // 3) –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤
        const rowsForExport = allData.map(row => {
          const obj = {};
          row.forEach((cell, idx) => {
            obj[ headers[idx] ] = cell;
          });
          return obj;
        });

        // 4) –°–æ–∑–¥–∞—ë–º –∫–Ω–∏–≥—É –∏ –ª–∏—Å—Ç
        const ws = XLSX.utils.json_to_sheet(rowsForExport, { header: headers });
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "–ê–ª—å—Ñ–∞ –Ω–æ–º–µ—Ä–∞");

        // 5) –°–∫–∞—á–∏–≤–∞–µ–º
        XLSX.writeFile(wb, "Category3Names.xlsx");
      };
    });
  </script>
{% endblock %}
